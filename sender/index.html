<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="manifest" href="./manifest.json" />
    <link rel="apple-touch-icon" href="./logo.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>AirDash</title>
  </head>
  <body>
    <h1>AirDash</h1>
    <p>Easiest file transfer from Android to Computer</p>

    <form action="/" method="POST">
      <label>Text <input id="test" name="text" ></label>
      <label>File <input name="file" type="file"></label>

      <input type="submit">
    </form>




    <p>You can also share a file to this app from the Android share menu.</p>

    <p>The file will be sent to the the connected computer</p>

    <h3>Current Message</h3>
    <pre id="message">Loading...</pre>

    <script src="https://unpkg.com/localforage@1.7.3/dist/localforage.js"></script>
    <script src="https://unpkg.com/peerjs@1.0.0/dist/peerjs.min.js"></script>
    <script>
      ;(async function() {
        if ('serviceWorker' in navigator) {
          try {
            await navigator.serviceWorker.register('./sw.js')
          } catch(err) {
            console.log('sw failed', err)
          }
        }

        const message = await localforage.getItem('message')

        const peer = new peerjs.Peer()
        const conn = peer.connect('simonbengtsson-airdash')
        conn.on('open', function() {
          conn.send(message)
          document.querySelector('#message').textContent = message
          console.log('Sent message: ', message)
        })
        conn.on('error', function(err) {
          console.log('err', err)
        })
      })()
    </script>
  </body>
</html>
